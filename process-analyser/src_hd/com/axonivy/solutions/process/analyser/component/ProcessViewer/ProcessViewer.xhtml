<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://java.sun.com/jsp/jstl/core">
<cc:interface componentType="IvyComponent">
  <cc:attribute name="managedBean" required="true" />
</cc:interface>

<cc:implementation>
  <c:set var="managedBean" value="#{cc.attrs.managedBean}" />
  <h:outputScript name="resources/process-viewer.js" target="head" />
  <f:event listener="#{processViewerBean.init(managedBean.selectedProcessAnalyser)}" type="preRenderComponent" />
  <h:panelGroup id="viewer-group" layout="block">
    <p:panel id="viewer-panel" widgetVar="viewer-panel" toggleable="true" toggleSpeed="500"
      toggleTitle="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/ToggleTooltip')}"
      styleClass="viewer-group">
      <f:facet name="header">
        <h:outputText id="header" value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/MiningData')}" />
        <p:outputLabel for="header" id="header-tooltip">
          <i class="ui-icon pi pi-info-circle ml-1" />
        </p:outputLabel>
        <p:tooltip for="header-tooltip" trackMouse="true"
          value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/ResizeTooltip')}" />
      </f:facet>
      <f:facet name="actions">
        <h:panelGroup styleClass="flex flex-row-reverse">
          <p:commandLink id="open-viewer-on-new-tab-link"
            styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" onclick="openViewerInNewTab()"
            update="@none" disabled="#{!processViewerBean.shouldRenderBpmnFrame()}" process="@this" partialSubmit="true"
            immediate="true">
            <h:outputText styleClass="ui-icon pi pi-external-link" />
          </p:commandLink>
          <p:tooltip for="@previous" trackMouse="true"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/OpenOnNewTabTooltip')}" />
          <p:commandLink id="config-viewer-link" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"
            disabled="#{ not (processViewerBean.shouldRenderBpmnFrame() or managedBean.isWidgetMode)}" process="@this"
            partialSubmit="true" immediate="true">
            <h:outputText styleClass="ui-icon pi pi-cog" />
          </p:commandLink>
          <p:commandLink id="config-filter-link" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"
            rendered="#{managedBean.isWidgetMode}" process="@this" partialSubmit="true" immediate="true">
            <h:outputText styleClass="ui-icon pi pi-filter" />
          </p:commandLink>
          <ic:com.axonivy.solutions.process.analyser.component.AdditionalFeatures
            componentsToUpdate="process-analytics-form" managedBean="#{managedBean}"
            containerClasses=" grid align-items-center mr-2" rendered="#{managedBean.isWidgetMode}" />
        </h:panelGroup>
        <p:overlayPanel for="config-filter-link" styleClass="toolbar-overlay-panel" my="right bottom" at="right top">
          <h:panelGroup styleClass="grid formgrid ui-fluid">
            <ic:com.axonivy.solutions.process.analyser.component.StandardFilter id="standard-filter" managedBean="#{managedBean}"
              isWidgetMode="#{managedBean.isWidgetMode}" />
          </h:panelGroup>
        </p:overlayPanel>
        <p:overlayPanel for="config-viewer-link" styleClass="toolbar-overlay-panel" my="right bottom" at="right top">
          <h:panelGroup id="toolbar-group" styleClass="grid formgrid ui-fluid">
            <h:panelGroup styleClass="col-12 flex justify-content-between flex-row">
              <h:outputText value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/ViewerConfig')}" />
              <p:commandButton icon="ui-icon pi pi-check"
                styleClass="w-auto"
                actionListener="#{processViewerBean.refreshBpmnIFrame()}"
                partialSubmit="true" process="toolbar-group"
                update="@this viewer-panel viewer-group-resize process-analytics-form"
                title="#{ivy.cms.co('/Labels/Apply')}"
                value="#{ivy.cms.co('/Labels/Apply')}" />
            </h:panelGroup>
            <h:panelGroup styleClass="ui-fluid col-12 mb-2">
              <p:tooltip for="focus-item-label" trackMouse="true"
                value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/FocusItemTooltip')}" />
              <p:outputLabel id="focus-item-label" for="focus-item"
                value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/FocusItem')}"
                styleClass="w-full">
                <i class="ui-icon pi pi-info-circle ml-1" />
              </p:outputLabel>
              <p:selectOneMenu id="focus-item" value="#{processViewerBean.selectedItem}">
                <f:selectItem noSelectionOption="true" />
                <f:selectItems value="#{processViewerBean.availableProcessElements}" var="element"
                  itemValue="#{element.pid}" itemLabel="#{element.displayName}" />
              </p:selectOneMenu>
            </h:panelGroup>

            <h:panelGroup id="zoom-group" styleClass="col-12 grid formgrid">
              <p:tooltip for="zoom-label" trackMouse="true"
                value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/ZoomTooltip')}" />
              <p:outputLabel id="zoom-label" for="zoom" value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/Zoom')}"
                styleClass="col-12">
                <i class="ui-icon pi pi-info-circle ml-1" />
              </p:outputLabel>
              <p:inputNumber id="zoom" decimalPlaces="0" minValue="0" value="#{processViewerBean.selectedZoom}"
                symbol="%" symbolPosition="s" maxValue="1000" styleClass="col-12" inputStyleClass="viewer-config-zoom" onkeypress="return false;">
              </p:inputNumber>
            </h:panelGroup>
          </h:panelGroup>
        </p:overlayPanel>
      </f:facet>
      <h:panelGroup rendered="#{processViewerBean.shouldRenderBpmnFrame()}">
        <iframe id="process-analytic-viewer" src="#{processViewerBean.bpmnIframeSourceUrl}" width="100%" height="100%"
          class="process-analytic-viewer" onload="loadIframe(false)" />
      </h:panelGroup>
      <h:panelGroup rendered="#{!processViewerBean.shouldRenderBpmnFrame()}" styleClass="col mb-2" layout="block">
        <h:outputText value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/component/ProcessViewer/EmptyDataMessage')}" />
      </h:panelGroup>
    </p:panel>
    <p:resizable id="viewer-group-resize" for="viewer-panel" animate="true" ghost="true" grid="20" handles="s"
      proxy="true" />
  </h:panelGroup>
</cc:implementation>
</html>
