<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://java.sun.com/jsp/jstl/core">
<cc:interface>
  <cc:attribute name="managedBean" required="true" />
  <cc:attribute name="isWidgetMode" default="false" />
  
</cc:interface>
<cc:implementation>
  <c:set var="managedBean" value="#{cc.attrs.managedBean}" />
  <c:set var="isWidgetMode" value="#{cc.attrs.isWidgetMode}" />
  <h:panelGroup layout="block">
    <p:panelGrid columns="2" layout="grid" styleClass="ui-fluid" rendered="#{!isWidgetMode}"
      columnClasses="ui-g-6 pl-0, ui-g-6 pr-0 mr-0 grid align-items-center flex-row-reverse">
      <h:panelGroup layout="block" styleClass="flex align-items-center h-full">
        <h3>#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessAnalytics/Title')}</h3>
      </h:panelGroup>

      <h:panelGroup>
        <p:commandButton id="show-statistic-btn" icon="pi pi-chart-line"
          value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/ShowStatistic')}"
          styleClass="show-statistic-btn w-auto" update="process-analytics-form"
          actionListener="#{managedBean.updateDiagramAndStatistic}" disabled="#{managedBean.showStatisticBtnDisabled}" />
        <ic:com.axonivy.solutions.process.analyser.component.AdditionalFeatures
          componentsToUpdate="process-analytics-form" managedBean="#{managedBean}"
          containerClasses="grid mr-4 grid align-items-center line-height-4 mt-1" />
      </h:panelGroup>
    </p:panelGrid>

    <div id="search-fields" class="col-12 px-0 mx-0 grid formgrid ui-fluid">
      <h:panelGroup styleClass="col-4 p-0 m-0 pr-2" layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectProject')}" />
        </div>
        <p:selectOneMenu id="moduleDropdown" value="#{managedBean.selectedModule}" styleClass="w-full">
          <f:selectItem
            itemLabel="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectProject')}"
            itemValue="#{null}" noSelectionOption="true" />
          <f:selectItems value="#{managedBean.availableModules}" var="module" itemLabel="#{module}"
            itemValue="#{module}" />
          <p:ajax event="change" partialSubmit="true" process="@this" listener="#{managedBean.onModuleSelect}" />
        </p:selectOneMenu>
      </h:panelGroup>

      <h:panelGroup id="process-selection-group" styleClass="col-4 p-0 m-0 px-1" layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectProcess')}">
            <p:outputLabel id="header-tooltip">
              <i class="ui-icon pi pi-info-circle ml-1" />
            </p:outputLabel>
            <p:tooltip for="header-tooltip" trackMouse="true"
              value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/ProcessTooltip')}" />
          </p:outputLabel>
        </div>

        <c:if test="#{!managedBean.mergeProcessStarts}">
          <p:cascadeSelect id="process-dropdown" value="#{managedBean.selectedProcessAnalyser}"
            placeholder="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectProcess')}"
            converter="processStartConverter" styleClass="w-full">
            <f:selectItems value="#{managedBean.availableProcessStarts}" />
            <p:ajax partialSubmit="true" process="@this" listener="#{managedBean.onProcessSelect}" />
          </p:cascadeSelect>
        </c:if>

        <c:if test="#{managedBean.mergeProcessStarts}">
          <p:selectOneMenu value="#{managedBean.selectedProcessAnalyser}" converter="processStartConverter"
            styleClass="w-full">
            <f:selectItem
              itemLabel="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectProcess')}"
              itemValue="#{null}" noSelectionOption="true" />
            <f:selectItems value="#{managedBean.availableProcessStarts}" />
            <p:ajax event="change" listener="#{managedBean.onProcessSelect}" />
          </p:selectOneMenu>
        </c:if>
      </h:panelGroup>

      <h:panelGroup styleClass="col-4 p-0 m-0 pl-2" layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectKPI')}" />
        </div>
        <p:cascadeSelect id="kpiDropdown" style="width: 100%"
          placeholder="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectKPI')}"
          value="#{managedBean.selectedKpiType}" converter="kpiTypeConverter">
          <f:selectItems value="#{managedBean.kpiTypes}" />
          <p:ajax event="itemSelect" listener="#{managedBean.onKpiTypeSelect}"
            update="process-analytics-form:color-picker-component:color-container" process="@this" partialSubmit="true" />
        </p:cascadeSelect>
      </h:panelGroup>
    </div>

    <h:panelGroup id="time-interval-group" styleClass="field col-12 grid formgrid align-items-start p-0 m-0 field"
      layout="block">
      <ui:include src="TimeIntervalFilter.xhtml" />
      <p:remoteCommand id="filter-data-by-interval-rc" name="filterDataByIntervalRC"
        actionListener="#{managedBean.updateDataOnChangingFilter()}" process="@this" partialSubmit="true" />
    </h:panelGroup>
  </h:panelGroup>
</cc:implementation>

</html>
