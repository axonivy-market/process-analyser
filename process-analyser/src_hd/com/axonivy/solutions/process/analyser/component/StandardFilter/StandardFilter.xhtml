<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://java.sun.com/jsp/jstl/core">
<cc:interface >
  <cc:attribute name="isWidgetMode" default="false" />
</cc:interface>
<cc:implementation>
  <c:set var="managedBean" value="#{processesAnalyticsBean}" />
  <c:set var="isWidgetMode" value="#{cc.attrs.isWidgetMode}" />
  <h:panelGroup layout="block">
    <p:panelGrid columns="2" layout="grid" styleClass="ui-fluid" rendered="#{!isWidgetMode}"
      columnClasses="ui-g-6 pl-0, ui-g-6 pr-0 mr-0 grid align-items-center flex-row-reverse">
      <h:panelGroup layout="block" styleClass="flex align-items-center h-full">
        <h3>#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessAnalytics/Title')}</h3>
      </h:panelGroup>
      <h:panelGroup>
        <p:commandButton id="show-statistic-btn" icon="pi pi-chart-line"
          value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/ShowStatistic')}"
          styleClass="show-statistic-btn w-auto" update="process-analytics-form"
          actionListener="#{managedBean.updateDiagramAndStatistic}" disabled="#{managedBean.showStatisticBtnDisabled}" />
        <ic:com.axonivy.solutions.process.analyser.component.AdditionalFeatures
          id="additional-feature"
          componentsToUpdate="process-analytics-form"
          onChangeIncludingRunningCases="#{managedBean.onChangeIncludingRunningCases}"
          onChangeMergeProcessStarts="#{managedBean.onChangeMergeProcessStarts}"
          containerClasses="grid mr-4 grid align-items-center line-height-4 mt-1  mb-2" />
      </h:panelGroup>
    </p:panelGrid>
    <h:panelGroup layout="block"
      styleClass="w-full pb-2 mx-0 grid formgrid ui-fluid #{isWidgetMode? 'flex-column px-2': 'flex-row px-0'}">
      <h:panelGroup
        styleClass="#{isWidgetMode? 'col mb-2': 'col-3 pr-1'} p-0 m-0"
        layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectProject')}" />
        </div>
        <p:selectOneMenu id="moduleDropdown"
          value="#{masterDataBean.selectedModule}" styleClass="w-full">
          <f:selectItem
            itemLabel="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectProject')}"
            itemValue="#{null}" noSelectionOption="true" />
          <f:selectItems value="#{masterDataBean.availableModules}"
            var="module" itemLabel="#{module}" itemValue="#{module}" />
          <p:ajax event="change" partialSubmit="true" process="@this"
            listener="#{managedBean.onModuleSelect}" />
        </p:selectOneMenu>
      </h:panelGroup>
      <h:panelGroup id="pmv-selection-group" styleClass="#{isWidgetMode? 'col mb-2': 'col-3 px-1'} p-0 m-0"
        layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectPMV')}" />
        </div>
        <p:selectOneMenu id="pmvDropdown" value="#{masterDataBean.selectedPMV}" styleClass="w-full"
          converter="pmvConverter">
          <f:selectItem
            itemLabel="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectPMV')}"
            itemValue="#{null}" noSelectionOption="true" />
          <f:selectItems value="#{masterDataBean.availablePMV}" var="pmv" itemLabel="#{masterDataBean.getPmvLabel(pmv)}"
            itemValue="#{pmv}" />
          <p:ajax event="change" partialSubmit="true" process="@this" listener="#{managedBean.onPmvSelect}" />
        </p:selectOneMenu>
      </h:panelGroup>
      <h:panelGroup id="process-selection-group" styleClass="#{isWidgetMode? 'col mb-2 px-0': 'col-3 px-1'} p-0 m-0"
        layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/Process')}">
            <p:outputLabel id="header-tooltip">
              <i class="ui-icon pi pi-info-circle ml-1" />
            </p:outputLabel>
            <p:tooltip for="header-tooltip" trackMouse="true"
              value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/ProcessTooltip')}" />
          </p:outputLabel>
        </div>
        <c:if test="#{not masterDataBean.mergeProcessStarts}">
          <p:cascadeSelect id="process-dropdown" value="#{masterDataBean.selectedProcessAnalyser}"
            placeholder="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectProcess')}"
            converter="processStartConverter" styleClass="w-full">
            <f:selectItems value="#{masterDataBean.availableProcessStarts}" />
            <p:ajax partialSubmit="true" process="@this" listener="#{processesAnalyticsBean.onProcessSelect}" />
          </p:cascadeSelect>
        </c:if>
        <c:if test="#{masterDataBean.mergeProcessStarts}">
          <p:selectOneMenu id="process-merge-dropdown" value="#{masterDataBean.selectedProcessAnalyser}"
            converter="processStartConverter" styleClass="w-full">
            <f:selectItem
              itemLabel="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectProcess')}"
              itemValue="#{null}" noSelectionOption="true" />
            <f:selectItems value="#{masterDataBean.availableProcessStarts}" />
            <p:ajax event="change" listener="#{processesAnalyticsBean.onProcessSelect}" />
          </p:selectOneMenu>
        </c:if>
      </h:panelGroup>
      <h:panelGroup styleClass="#{isWidgetMode? 'col mb-2': 'col-3 pl-1'} p-0 m-0" layout="block">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectKPI')}" />
        </div>
        <p:cascadeSelect id="kpiDropdown" styleClass="w-full"
          placeholder="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectKPI')}"
          value="#{masterDataBean.selectedKpiType}" converter="kpiTypeConverter">
          <f:selectItems value="#{masterDataBean.kpiTypes}" />
          <p:ajax event="itemSelect" listener="#{processesAnalyticsBean.onKpiTypeSelect}"
            update="process-analytics-form:color-picker-component:color-container" process="@this" partialSubmit="true" />
        </p:cascadeSelect>
      </h:panelGroup>
    </h:panelGroup>
    <h:panelGroup id="search-fields" layout="block"
      styleClass="w-full mx-0 grid formgrid ui-fluid #{isWidgetMode? 'flex-column px-2': 'flex-row px-0'}">
      <h:panelGroup
        styleClass="#{isWidgetMode? 'col mb-2': 'col-3 pr-1'} p-0 m-0"
        layout="block"  id="role-selection-group">
        <div class="mb-2">
          <p:outputLabel for="@next"
            value="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/PleaseSelectRole')}" />
        </div>
        <p:selectOneMenu id="role-dropDown"
          value="#{masterDataBean.selectedRole}" styleClass="w-full">
          <f:selectItem
            itemLabel="#{ivy.cms.co('/Dialogs/com/axonivy/solutions/process/analyser/ProcessesMonitor/SelectRole')}"
            itemValue="#{null}" noSelectionOption="true" />
          <f:selectItems value="#{masterDataBean.availableRoles}"/>
          <p:ajax event="change" partialSubmit="true" process="@this"
            listener="#{managedBean.onRoleSelect}" />
        </p:selectOneMenu>
      </h:panelGroup>
      <h:panelGroup id="time-interval-group" styleClass="#{isWidgetMode ? 'px-0 col-12' : 'pr-0 pl-1 col-9'} field grid formgrid align-items-start m-0 field"
        layout="block">
        <ui:include src="TimeIntervalFilter.xhtml">
          <ui:param name="isWidgetMode" value="#{isWidgetMode}" />
        </ui:include>
        <p:remoteCommand id="filter-data-by-interval-rc" name="filterDataByIntervalRC"
          actionListener="#{processesAnalyticsBean.updateDataOnChangingFilter}" process="@this" partialSubmit="true" />
      </h:panelGroup>
    </h:panelGroup>
  </h:panelGroup>
</cc:implementation>
</html>
