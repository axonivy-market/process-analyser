<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
  <ui:composition template="/layouts/basic-10.xhtml">
    <ui:define name="title">CustomFilter</ui:define>
    <ui:define name="content">

      <h:form id="form">
        <div class="col-12 p-0 m-0 pr-2">
          <p:selectCheckboxMenu id="multiple" multiple="true" emptyLabel="None" updateLabel="true"
            style="min-width: 15rem" panelStyle="width: 30rem" scrollHeight="250"
            value="#{customFilterBean.selectedCustomFilters.keySet()}">
            <p:ajax event="change" listener="#{processesAnalyticsBean.onSelectCustomField()}" />
            <f:selectItems value="#{processesAnalyticsBean.customFieldMap.keySet()}" var="fieldName"
              itemValue="#{fieldName}" itemLabel="#{fieldName}" />
          </p:selectCheckboxMenu>
        </div>
        </h:panelGroup>

        <h:panelGroup id="process-custom-filter" styleClass="col-12 px-0 mx-0 grid formgrid ui-fluid">
          <div class="col-12 m-0 p-0 mb-2">
            <!-- Iterate over each selected custom field in customFilters -->
            <ui:repeat value="#{customFilterBean.selectedCustomFilters.keySet()}" var="fieldName">
              <!-- Output the label for each selected field -->
              <div class="col-12 p-0 m-0 pr-2 mb-2">
                <p:outputLabel value="#{fieldName}" />
              </div>

              <!-- Dropdown menu for each selected field -->
              <div class="col-4 p-0 m-0 pr-2">
                <p:selectOneMenu value="#{customFilterBean.selectedCustomFilters[fieldName]}" id="dropdown_#{fieldName}">
                  <!-- Populate the dropdown options with values from customFieldMap for the current field -->
                  <f:selectItems value="#{customFilterBean.selectedCustomFilters[fieldName]}" var="optionValue"
                    itemValue="#{optionValue}" itemLabel="#{optionValue}" />
                  <p:ajax listener="#{processesAnalyticsBean.onDropdownChange}" process="@this" partialSubmit="true"
                    update="@form" />
                </p:selectOneMenu>
              </div>
            </ui:repeat>
          </div>

        </h:panelGroup>
      </h:form>

    </ui:define>
  </ui:composition>
</h:body>

</html>
